{% extends 'base.html' %}

{% block title %}Label Preview - Summerfest{% endblock %}

{% block content %}
<div class="container py-4">
  <h2><i class="bi bi-tags"></i> Printable Label Preview</h2>
  <p class="text-muted">Adjustable label sizes. Black & white friendly. Icons greyed when "No". This page is for layout testing only.</p>

  <!-- Label Size Controls -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h5><i class="bi bi-rulers"></i> Label Size Controls</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-4">
              <label for="label-width" class="form-label">Width (mm)</label>
              <input type="number" id="label-width" class="form-control" value="50" min="20" max="100" step="1">
            </div>
            <div class="col-4">
              <label for="label-height" class="form-label">Height (mm)</label>
              <input type="number" id="label-height" class="form-control" value="30" min="15" max="60" step="1">
            </div>
            <div class="col-4">
              <label for="font-scale" class="form-label">Font Scale</label>
              <input type="number" id="font-scale" class="form-control" value="1.0" min="0.5" max="2.0" step="0.1">
            </div>
          </div>
          <div class="mt-3">
            <button class="btn btn-primary btn-sm" onclick="updateLabelSizes()">
              <i class="bi bi-arrow-clockwise"></i> Update Preview
            </button>
            <button class="btn btn-outline-secondary btn-sm ms-2" onclick="resetToDefault()">
              <i class="bi bi-arrow-counterclockwise"></i> Reset to Default
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h5><i class="bi bi-info-circle"></i> Current Settings</h5>
        </div>
        <div class="card-body">
          <p class="mb-1"><strong>Label Size:</strong> <span id="current-size">50mm × 30mm</span></p>
          <p class="mb-1"><strong>Font Scale:</strong> <span id="font-scale-display">1.0x</span></p>
          <p class="mb-0"><strong>Recommended:</strong> 50mm × 30mm (standard)</p>
        </div>
      </div>
    </div>
  </div>

  <div class="d-flex flex-wrap gap-3" id="label-container">
    {% for s in samples %}
    <div class="label-card" data-width="50" data-height="30">
      <div class="label-grid">
        <div class="col-left">
          <div class="first-name">{{ s.first_name }}</div>
          <div class="surname">{{ s.last_name }}</div>
          <div class="class-name">{{ s.class_display }}</div>
        </div>
        <div class="col-icons">
          <div class="icon {% if s.medical %}yes{% else %}no{% endif %}" title="Medical needs">
            <!-- First aid cross -->
            <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
              <rect x="9" y="3" width="6" height="18" rx="2"></rect>
              <rect x="3" y="9" width="18" height="6" rx="2"></rect>
            </svg>
          </div>
          <div class="icon {% if s.dietary %}yes{% else %}no{% endif %}" title="Dietary needs">
            <!-- Plate with knife and fork -->
            <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
              <circle cx="12" cy="12" r="7" fill="currentColor"></circle>
              <rect x="3" y="3" width="2" height="18"></rect>
              <rect x="19" y="3" width="2" height="18"></rect>
            </svg>
          </div>
          <div class="icon {% if s.photo %}yes{% else %}no{% endif %}" title="Photo consent">
            <!-- Camera -->
            <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
              <rect x="3" y="7" width="18" height="12" rx="2"></rect>
              <circle cx="12" cy="13" r="4" fill="white"></circle>
            </svg>
          </div>
        </div>
        <div class="col-yn">
          <div class="yn {% if s.medical %}yes{% else %}no{% endif %}">{% if s.medical %}Yes{% else %}No{% endif %}</div>
          <div class="yn {% if s.dietary %}yes{% else %}no{% endif %}">{% if s.dietary %}Yes{% else %}No{% endif %}</div>
          <div class="yn {% if s.photo %}yes{% else %}no{% endif %}">{% if s.photo %}Yes{% else %}No{% endif %}</div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <div class="mt-3">
    <button class="btn btn-outline-primary btn-sm" onclick="window.print()"><i class="bi bi-printer"></i> Print</button>
  </div>
</div>

<style>
/***** Dynamic label sizing *****/
.label-card {
  border: 1px solid #000;
  padding: 0.2cm; /* ~2mm border equivalent */
  box-sizing: border-box;
  transition: all 0.3s ease;
}

/* 3 columns: text | icons | yes/no */
.label-grid {
  display: grid;
  grid-template-columns: 1fr auto auto;
  column-gap: 0.2cm; /* 2mm gap */
  height: 100%;
  align-items: center;
}

.col-left { display: flex; flex-direction: column; justify-content: center; }
.first-name { font-weight: 700; }
.surname { color: #666; margin: 2mm 0; text-transform: uppercase; }
.class-name { font-weight: 700; }

.col-icons { display: flex; flex-direction: column; align-items: center; gap: 2mm; }
.icon { color: #000; }
.icon.no { color: #bbb; filter: grayscale(100%); }

.col-yn { display: flex; flex-direction: column; align-items: flex-start; gap: 2mm; }
.yn { font-weight: 700; }
.yn.no { color: #bbb; }

@media print {
  body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  .btn { display: none; }
  .card { border: none !important; box-shadow: none !important; }
}
</style>

<script>
function updateLabelSizes() {
  const width = parseInt(document.getElementById('label-width').value);
  const height = parseInt(document.getElementById('label-height').value);
  const fontScale = parseFloat(document.getElementById('font-scale').value);
  
  // Update current size display
  document.getElementById('current-size').textContent = `${width}mm × ${height}mm`;
  
  // Update font scale display
  document.getElementById('font-scale-display').textContent = `${fontScale.toFixed(1)}x`;
  
  // Update all label cards
  const labelCards = document.querySelectorAll('.label-card');
  labelCards.forEach(card => {
    // Set physical dimensions
    card.style.width = `${width}mm`;
    card.style.height = `${height}mm`;
    
    // Update font sizes based on scale
    const firstName = card.querySelector('.first-name');
    const surname = card.querySelector('.surname');
    const className = card.querySelector('.class-name');
    
    if (firstName) {
      firstName.style.fontSize = `${10 * fontScale}mm`;
      firstName.style.lineHeight = `${10 * fontScale}mm`;
    }
    if (surname) {
      surname.style.fontSize = `${2 * fontScale}mm`;
      surname.style.lineHeight = `${2 * fontScale}mm`;
    }
    if (className) {
      className.style.fontSize = `${10 * fontScale}mm`;
      className.style.lineHeight = `${10 * fontScale}mm`;
    }
    
    // Update icon sizes
    const icons = card.querySelectorAll('.icon svg');
    icons.forEach(icon => {
      const iconSize = Math.round(20 * fontScale);
      icon.setAttribute('width', iconSize);
      icon.setAttribute('height', iconSize);
    });
    
    // Update yes/no text sizes
    const ynElements = card.querySelectorAll('.yn');
    ynElements.forEach(yn => {
      yn.style.fontSize = `${8 * fontScale}mm`;
    });
  });
}

function resetToDefault() {
  document.getElementById('label-width').value = 50;
  document.getElementById('label-height').value = 30;
  document.getElementById('font-scale').value = 1.0;
  updateLabelSizes();
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
  updateLabelSizes();
});
</script>
{% endblock %}
